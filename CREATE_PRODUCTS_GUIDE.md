# Руководство по созданию товаров из прайс-листов

## Подготовка

1. **Убедитесь, что API сервер запущен:**
   ```bash
   cd apps/api
   pnpm dev:api
   ```

2. **Получите dev токен:**
   ```bash
   # Способ 1: Через браузер
   # Откройте: http://localhost:3000/api/auth/dev-token
   
   # Способ 2: Через curl
   curl http://localhost:3000/api/auth/dev-token
   ```

3. **Установите токен в переменную окружения:**
   ```bash
   export AUTH_TOKEN=ваш_токен_здесь
   ```

## Шаг 1: Создание категорий

Сначала создайте все категории из фронтенда:

```bash
cd apps/api
pnpm create:categories
```

Это создаст следующие категории:

### Мраморные категории:
- `marble-monuments` - Памятники из мрамора
- `marble-popular` - Популярные модели
- `marble-slabs` - Плита из мрамора (Каталог 1)
- `marble-vases` - Вазы
- `marble-chips` - Крошка (Каталог 1)

### Гранитные категории:
- `granite-monuments` - Памятники из гранита
- `granite-popular` - Популярные модели
- `granite-slabs` - Плита из гранита
- `granite-vases` - Вазы
- `granite-chips` - Крошка

### Ритуальные категории (Каталог 3):
- `ritual-steles` - Стелы ритуальные
- `ritual-pedestals` - Тумбы ритуальные
- `ritual-flowerbeds` - Цветники ритуальные
- `ritual-sets` - Комплекты ритуальные

## Шаг 2: Применение миграции для поля material

```bash
cd apps/api
npx prisma migrate dev
npx prisma generate
```

## Шаг 3: Создание товаров

### Первый прайс-лист (Каталог 1 - Плита из мрамора, Крошка)

Товары из первого прайс-листа (кроме ваз, которые уже созданы) будут созданы в категории **"Плита из мрамора"** (`marble-slabs`) и **"Крошка"** (`marble-chips`):

1. **Плита мраморная полированная** (MATRIX: Размер × Сорт)
   - Категория: `marble-slabs`
   - Материал: `MARBLE`
   - Тип: `MATRIX`
   - Единица: `м²`

2. **Заказная плита** (SINGLE_VARIANT: Толщина)
   - Категория: `marble-slabs`
   - Материал: `MARBLE`
   - Тип: `SINGLE_VARIANT`
   - Единица: `м²`

3. **Плитка тротуарная** (SIMPLE)
   - Категория: `marble-slabs`
   - Материал: `MARBLE`
   - Тип: `SIMPLE`
   - Единица: `м²`
   - Цена: По запросу

4. **Мраморная брекчия** (SINGLE_VARIANT: Форма)
   - Категория: `marble-slabs`
   - Материал: `MARBLE`
   - Тип: `SINGLE_VARIANT`
   - Единица: `м²`

5. **Декоративная мраморная крошка, песок** (MATRIX: Фракция × Упаковка)
   - Категория: `marble-chips`
   - Материал: `MARBLE`
   - Тип: `MATRIX`
   - Единица: `Тонна`

### Второй прайс-лист (Каталог 3 - Ритуальные изделия)

Товары из второго прайс-листа будут созданы в соответствующих ритуальных категориях:

1. **Стела ритуальная** (MATRIX: Высота × Размер сечения)
   - Категория: `ritual-steles`
   - Материал: `MARBLE`
   - Тип: `MATRIX`
   - Единица: `шт`

2. **Тумба ритуальная** (MATRIX: Размер основания × Высота)
   - Категория: `ritual-pedestals`
   - Материал: `MARBLE`
   - Тип: `MATRIX`
   - Единица: `шт`

3. **Цветник ритуальный** (MATRIX: Размер × Обработка)
   - Категория: `ritual-flowerbeds`
   - Материал: `MARBLE`
   - Тип: `MATRIX`
   - Единица: `комплект`

4. **Ритуальная ваза** (MATRIX: Высота × Диаметр)
   - Категория: `ritual-steles` (можно создать отдельную категорию)
   - Материал: `MARBLE`
   - Тип: `MATRIX`
   - Единица: `шт`

## Запуск скрипта создания товаров

```bash
cd apps/api
pnpm create:products
```

## Структура товаров

### Разделение по материалам

Все товары имеют поле `material`:
- `MARBLE` - Мрамор
- `GRANITE` - Гранит
- `null` - Не указан

### Разделение по каталогам

- **Каталог 1** (`marble-slabs`, `marble-chips`): Плиты, крошка, песок
- **Каталог 3** (`ritual-steles`, `ritual-pedestals`, `ritual-flowerbeds`, `ritual-sets`): Ритуальные изделия

## Проверка

После запуска скриптов проверьте товары в админ-панели:
- Откройте: http://localhost:5174/products
- Войдите с dev токеном
- Убедитесь, что:
  - Товары созданы в правильных категориях
  - Поле "Материал" отображается в карточках товаров
  - Все варианты и атрибуты созданы корректно

## Очистка старых тестовых данных

Если в базе есть старые тестовые товары (iPhone, Samsung, футболки и т.д.), их можно деактивировать:

```bash
cd apps/api
export AUTH_TOKEN=ваш_токен
pnpm cleanup:test-data
```

Это деактивирует старые категории (electronics, clothing, food) и товары, которые не относятся к мрамору/граниту.

## Добавление новых товаров

Чтобы добавить товары из следующего прайс-листа, отредактируйте файл `apps/api/scripts/create-test-products.ts` и добавьте новые вызовы `createProduct()` с указанием правильной категории и материала.

