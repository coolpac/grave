# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–µ–ª–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã

## –ü—Ä–æ–±–ª–µ–º–∞

–û—à–∏–±–∫–∞ –≤ –∫–æ–Ω—Å–æ–ª–∏:
```
vendor-other-aFsmYwpc.js:21 Uncaught TypeError: Cannot read properties of undefined (reading 'useLayoutEffect')
```

**–ü—Ä–∏—á–∏–Ω–∞:** React –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –¥—Ä—É–≥–∏–µ –º–æ–¥—É–ª–∏ –ø—ã—Ç–∞—é—Ç—Å—è –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.

## –†–µ—à–µ–Ω–∏–µ

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Vite –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π:

1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `modulePreload` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –ø–æ—Ä—è–¥–∫–æ–º
2. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ `manualChunks` - React-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏—Å–∫–ª—é—á–µ–Ω—ã –∏–∑ `vendor-other`
3. ‚úÖ –£–ª—É—á—à–µ–Ω –ø–æ—Ä—è–¥–æ–∫ preload –º–æ–¥—É–ª–µ–π

## –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### 1. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ
cd apps/web
pnpm build

# –ò–ª–∏ —á–µ—Ä–µ–∑ –¥–µ–ø–ª–æ–π
./quick-deploy.sh web
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏:
1. –û—Ç–∫—Ä–æ–π—Ç–µ `http://optmramor.ru`
2. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å (F12)
3. –û—à–∏–±–∫–∞ `useLayoutEffect` –¥–æ–ª–∂–Ω–∞ –∏—Å—á–µ–∑–Ω—É—Ç—å
4. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è

### 3. –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–ª–∞—Å—å

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
- –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞ (Ctrl+Shift+Delete)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network tab - –≤—Å–µ JS —Ñ–∞–π–ª—ã –¥–æ–ª–∂–Ω—ã –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è (—Å—Ç–∞—Ç—É—Å 200)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—è–¥–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏: `vendor-react` –¥–æ–ª–∂–µ–Ω –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –ø–µ—Ä–≤—ã–º

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `vite.config.ts`:

1. **–î–æ–±–∞–≤–ª–µ–Ω `modulePreload`**:
   ```typescript
   modulePreload: {
     polyfill: true,
     resolveDependencies: (filename, deps) => {
       const reactChunk = deps.find(dep => dep.includes('vendor-react'))
       if (reactChunk) {
         return [reactChunk, ...deps.filter(dep => !dep.includes('vendor-react'))]
       }
       return deps
     }
   }
   ```

2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ `manualChunks`**:
   - React-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏—Å–∫–ª—é—á–µ–Ω—ã –∏–∑ `vendor-other`
   - –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è, —á—Ç–æ React –≤—Å–µ–≥–¥–∞ –≤ `vendor-react`

3. **–£–ø—Ä–æ—â–µ–Ω—ã –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤**:
   - –£–±—Ä–∞–Ω –ø—Ä–µ—Ñ–∏–∫—Å "0-" (–Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ—Ä—è–¥–æ–∫)
   - Vite —Å–∞–º —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ—Ä—è–¥–∫–æ–º —á–µ—Ä–µ–∑ preload

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ vendor-react –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø–µ—Ä–≤—ã–º
curl -s http://optmramor.ru | grep -o 'href="[^"]*vendor-react[^"]*"'
```

–î–æ–ª–∂–µ–Ω –±—ã—Ç—å `modulepreload` –¥–ª—è `vendor-react` –ø–µ—Ä–µ–¥ –¥—Ä—É–≥–∏–º–∏ –º–æ–¥—É–ª—è–º–∏.


