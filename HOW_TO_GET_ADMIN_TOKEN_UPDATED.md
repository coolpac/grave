# üîë –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–û–ë–ù–û–í–õ–ï–ù–û)

## ‚úÖ –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

1. **–í–∞–ª–∏–¥–∞—Ü–∏—è initData —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ADMIN_BOT_TOKEN** (—Å fallback –Ω–∞ BOT_TOKEN)
2. **–î–æ–±–∞–≤–ª–µ–Ω endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞** - —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ production!

---

## üì± –°–ø–æ—Å–æ–± 1: –° —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —á–µ—Ä–µ–∑ API (–ù–û–í–û–ï!)

### –í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ Telegram ID (—Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π)

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –í–∞—à Telegram ID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ `ADMIN_WHITELIST` –≤ `.env.production`

**–®–∞–≥–∏:**

1. **–£–∑–Ω–∞–π—Ç–µ —Å–≤–æ–π Telegram ID:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ Telegram
   - –ù–∞–π–¥–∏—Ç–µ [@userinfobot](https://t.me/userinfobot)
   - –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–∞—à ID (—á–∏—Å–ª–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä: `83146995`)

2. **–ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ API:**
   ```bash
   curl "https://optmramor.ru/api/auth/admin-token?telegramId=83146995"
   ```

   **–ò–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:**
   ```
   https://optmramor.ru/api/auth/admin-token?telegramId=83146995
   ```

3. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω –∏–∑ –æ—Ç–≤–µ—Ç–∞:**
   ```json
   {
     "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
     "message": "Admin token generated for telegramId: 83146995. Role: ADMIN"
   }
   ```

### –í–∞—Ä–∏–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ Telegram WebApp initData

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ Telegram WebApp:

1. **–û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Telegram**
2. **–ü–æ–ª—É—á–∏—Ç–µ initData** (—á–µ—Ä–µ–∑ JavaScript –≤ –∫–æ–Ω—Å–æ–ª–∏):
   ```javascript
   window.Telegram.WebApp.initData
   ```

3. **–û—Ç–ø—Ä–∞–≤—å—Ç–µ POST –∑–∞–ø—Ä–æ—Å:**
   ```bash
   curl -X POST https://optmramor.ru/api/auth/admin-token \
     -H "Content-Type: application/json" \
     -d '{"initData": "–í–ê–®_INIT_DATA"}'
   ```

---

## üíª –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (–∫–∞–∫ —Ä–∞–Ω—å—à–µ)

1. –û—Ç–∫—Ä–æ–π—Ç–µ: `https://optmramor.ru/admin`
2. –í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Telegram
3. –ù–∞–∂–º–∏—Ç–µ `F12` ‚Üí Console
4. –í—ã–ø–æ–ª–Ω–∏—Ç–µ: `localStorage.getItem('authToken')`
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω

---

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞

–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ –≤ —Å–∫—Ä–∏–ø—Ç–µ:

```bash
./create-products-on-server.sh
# –í—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω, –∫–æ–≥–¥–∞ —Å–∫—Ä–∏–ø—Ç –ø–æ–ø—Ä–æ—Å–∏—Ç
```

–ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ API:

```bash
curl -H "Authorization: Bearer –í–ê–®_–¢–û–ö–ï–ù" \
  https://optmramor.ru/api/products
```

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ ADMIN_WHITELIST

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à Telegram ID –≤ `.env.production`:

```env
ADMIN_WHITELIST=83146995
```

–ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:
```env
ADMIN_WHITELIST=83146995,123456789,987654321
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞

```bash
curl -H "Authorization: Bearer –í–ê–®_–¢–û–ö–ï–ù" \
  https://optmramor.ru/api/admin/products
```

–ï—Å–ª–∏ –ø–æ–ª—É—á–∏–ª–∏ —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ ‚Äî —Ç–æ–∫–µ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç! ‚úÖ

---

## üìã –ë—ã—Å—Ç—Ä–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞

1. **–£–∑–Ω–∞–π—Ç–µ —Å–≤–æ–π Telegram ID:** [@userinfobot](https://t.me/userinfobot) ‚Üí `/start`
2. **–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:**
   ```
   https://optmramor.ru/api/auth/admin-token?telegramId=–í–ê–®_ID
   ```
3. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω** –∏–∑ –æ—Ç–≤–µ—Ç–∞
4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–∫–µ–Ω** –≤ —Å–∫—Ä–∏–ø—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤

---

## üéØ –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –≤ –∫–æ–¥–µ

### 1. –í–∞–ª–∏–¥–∞—Ü–∏—è initData

–¢–µ–ø–µ—Ä—å –ø—Ä–æ–±—É–µ—Ç —Ç–æ–∫–µ–Ω—ã –≤ —Ç–∞–∫–æ–º –ø–æ—Ä—è–¥–∫–µ:
1. `ADMIN_BOT_TOKEN` (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω)
2. `BOT_TOKEN` (fallback)

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–¥–º–∏–Ω-–±–æ—Ç–∞ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏!

### 2. –ù–æ–≤—ã–π endpoint `/api/auth/admin-token`

–†–∞–±–æ—Ç–∞–µ—Ç –≤ production –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω:
- –ß–µ—Ä–µ–∑ `telegramId` (–µ—Å–ª–∏ –≤ whitelist)
- –ß–µ—Ä–µ–∑ `initData` (Telegram WebApp)

---

## üí° –°–æ–≤–µ—Ç—ã

- ‚úÖ –°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞: —á–µ—Ä–µ–∑ `?telegramId=–í–ê–®_ID`
- ‚úÖ –¢–æ–∫–µ–Ω –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 7 –¥–Ω–µ–π (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ `JWT_EXPIRES_IN`)
- ‚úÖ –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –∏—Å—Ç–µ–∫ ‚Äî –ø–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π —á–µ—Ä–µ–∑ API
- ‚úÖ –ù–µ –¥–µ–ª–∏—Ç–µ—Å—å —Ç–æ–∫–µ–Ω–æ–º ‚Äî —ç—Ç–æ –≤–∞—à –ª–∏—á–Ω—ã–π –∫–ª—é—á

---

## üêõ –ü—Ä–æ–±–ª–µ–º—ã?

### "Telegram ID not in admin whitelist"

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤—å—Ç–µ –≤–∞—à Telegram ID –≤ `ADMIN_WHITELIST` –≤ `.env.production`

### "Invalid initData"

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø–æ—Å–æ–± —Å `telegramId` –≤–º–µ—Å—Ç–æ `initData`

### "Token is invalid or expired"

**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ API







