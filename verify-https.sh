#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ HTTPS –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

PROJECT_DIR="/opt/ritual-app"
SERVER_IP="94.241.141.194"
DOMAIN="optmramor.ru"

echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTPS"
echo ""

cd "$PROJECT_DIR" || exit 1

# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ
echo "1. –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTPS –ª–æ–∫–∞–ª—å–Ω–æ:"
curl -k -I https://localhost 2>&1 | head -3
echo ""

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTP –ª–æ–∫–∞–ª—å–Ω–æ (–¥–æ–ª–∂–µ–Ω —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç—å)
echo "2. –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTP –ª–æ–∫–∞–ª—å–Ω–æ (–¥–æ–ª–∂–µ–Ω —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç—å –Ω–∞ HTTPS):"
curl -I http://localhost 2>&1 | head -5
echo ""

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ IP –∞–¥—Ä–µ—Å
echo "3. –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTPS —á–µ—Ä–µ–∑ IP –∞–¥—Ä–µ—Å:"
curl -k -I https://${SERVER_IP} 2>&1 | head -3
echo ""

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTP —á–µ—Ä–µ–∑ IP –∞–¥—Ä–µ—Å
echo "4. –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTP —á–µ—Ä–µ–∑ IP –∞–¥—Ä–µ—Å:"
curl -I http://${SERVER_IP} 2>&1 | head -5
echo ""

# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS
echo "5. –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS:"
dig +short ${DOMAIN} || nslookup ${DOMAIN} | grep -A 1 "Name:"
echo ""

# 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
echo "6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤:"
ss -tlnp | grep -E ':(80|443)' || echo "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: apt install net-tools && netstat -tlnp | grep -E ':(80|443)'"
echo ""

# 7. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
echo "7. –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:"
docker-compose -f docker-compose.production.yml ps
echo ""

# 8. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ web
echo "8. –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏ web (–µ—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏):"
docker-compose -f docker-compose.production.yml logs --tail=10 web | grep -i error || echo "–ù–µ—Ç –æ—à–∏–±–æ–∫"
echo ""

echo "=========================================="
echo "‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
echo "=========================================="
echo ""
echo "–ï—Å–ª–∏ HTTPS —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ, –Ω–æ –Ω–µ —á–µ—Ä–µ–∑ –¥–æ–º–µ–Ω:"
echo "  1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DNS - –¥–æ–º–µ–Ω –¥–æ–ª–∂–µ–Ω —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ ${SERVER_IP}"
echo "  2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall - –ø–æ—Ä—Ç—ã 80 –∏ 443 –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã"
echo "  3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å https://${DOMAIN} –≤ –±—Ä–∞—É–∑–µ—Ä–µ"
echo ""



