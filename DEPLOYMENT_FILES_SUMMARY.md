# üì¶ –°–≤–æ–¥–∫–∞ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –¥–µ–ø–ª–æ—è

## –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### üê≥ Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

1. **`apps/api/Dockerfile`**
   - Multi-stage build –¥–ª—è NestJS API
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç non-root –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
   - –í–∫–ª—é—á–∞–µ—Ç health checks

2. **`apps/web/Dockerfile`**
   - Multi-stage build –¥–ª—è React —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç nginx –¥–ª—è —Ä–∞–∑–¥–∞—á–∏ —Å—Ç–∞—Ç–∏–∫–∏
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

3. **`apps/web/nginx.conf`**
   - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è nginx –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
   - –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ API –∑–∞–ø—Ä–æ—Å–æ–≤
   - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
   - Security headers

4. **`docker-compose.production.yml`**
   - –ü–æ–ª–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
   - PostgreSQL, Redis, API, Frontend
   - –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ Prometheus –∏ Grafana
   - Health checks –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π restart

### üöÄ –°–∫—Ä–∏–ø—Ç—ã –¥–µ–ø–ª–æ—è

5. **`deploy.sh`**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è
   - –°–æ–∑–¥–∞–µ—Ç backup –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º
   - –ö–æ–ø–∏—Ä—É–µ—Ç —Ñ–∞–π–ª—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä
   - –°–æ–±–∏—Ä–∞–µ—Ç –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
   - –ü—Ä–∏–º–µ–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î

6. **`setup-server.sh`**
   - –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
   - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker –∏ Docker Compose
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ firewall
   - –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö backup

### üìù –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

7. **`env.production.template`**
   - –®–∞–±–ª–æ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
   - –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å –æ–ø–∏—Å–∞–Ω–∏—è–º–∏
   - –ì–æ—Ç–æ–≤ –∫ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—é

### üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

8. **`SERVER_MANAGEMENT_GUIDE.md`**
   - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Å–µ—Ä–≤–µ—Ä–æ–º
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏
   - –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º
   - –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

9. **`DEPLOYMENT_QUICK_START.md`**
   - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –¥–ª—è –¥–µ–ø–ª–æ—è
   - –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
   - –†–µ—à–µ–Ω–∏–µ —Ç–∏–ø–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º

10. **`DEPLOYMENT_FILES_SUMMARY.md`** (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
    - –û–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

```
/opt/ritual-app/
‚îú‚îÄ‚îÄ apps/
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ uploads/          # –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logs/              # –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ web/
‚îÇ       ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ       ‚îî‚îÄ‚îÄ nginx.conf
‚îú‚îÄ‚îÄ packages/
‚îú‚îÄ‚îÄ docker-compose.production.yml
‚îú‚îÄ‚îÄ .env                       # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–ù–ï –∫–æ–º–º–∏—Ç–∏—Ç—å!)
‚îú‚îÄ‚îÄ env.production.template
‚îú‚îÄ‚îÄ deploy.sh
‚îú‚îÄ‚îÄ setup-server.sh
‚îî‚îÄ‚îÄ backup-db.sh               # –°–æ–∑–¥–∞–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
```

---

## –ü–æ—Ä—è–¥–æ–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ü–µ—Ä–≤—ã–π –¥–µ–ø–ª–æ–π

```bash
# –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ
1. cp env.production.template .env.production
2. vim .env.production  # –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
3. ./deploy.sh production

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
ssh root@94.241.141.194
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ setup-server.sh –Ω–∞ —Å–µ—Ä–≤–µ—Ä
./setup-server.sh
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
# –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ
./deploy.sh production
```

### 3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd /opt/ritual-app
docker-compose -f docker-compose.production.yml logs -f
docker-compose -f docker-compose.production.yml restart api
```

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚úÖ –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç non-root –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π  
‚úÖ PostgreSQL –∏ Redis –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ Docker —Å–µ—Ç–∏  
‚úÖ API –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ nginx  
‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã security headers  
‚úÖ Firewall –Ω–∞—Å—Ç—Ä–æ–µ–Ω (UFW/Firewalld)  
‚úÖ Fail2Ban –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞  
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ backup  

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- Health checks: `http://94.241.141.194/api/health`
- –ú–µ—Ç—Ä–∏–∫–∏: `http://94.241.141.194/api/metrics`
- Prometheus (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): `http://94.241.141.194:9090`
- Grafana (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): `http://94.241.141.194:3001`

---

## –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ backup –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã —á–µ—Ä–µ–∑ cron:
- –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 2:00 AM
- –•—Ä–∞–Ω—è—Ç—Å—è –≤ `/opt/backups/ritual-app/`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ 30 –¥–Ω–µ–π

---

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs -f`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ health checks: `curl http://localhost:3000/api/health`
3. –°–º. —Ä–∞–∑–¥–µ–ª "–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º" –≤ `SERVER_MANAGEMENT_GUIDE.md`

